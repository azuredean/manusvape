# ManusVape 项目规划与设计文档

## 项目概述

**项目名称：** ManusVape - 澳洲电子烟独立电商网站

**目标市场：** 澳洲成年消费者（18岁及以上）

**核心价值主张：** 提供符合澳洲法规的高端电子烟产品，采用极简科技风格设计，确保用户体验流畅且合规。

---

## 澳洲电子烟法规合规要求

### 关键法规框架

澳洲对电子烟（尼古丁产品）的监管极为严格，主要法规包括：

1. **《治疗商品管理法》(Therapeutic Goods Act 1989)** - 将含尼古丁电子烟列为治疗商品，要求TGA（澳洲治疗商品管理局）批准
2. **《烟草法》(Tobacco Act 2012)** - 禁止向未成年人销售，要求清晰的年龄验证
3. **各州法规** - 不同州对电子烟销售有额外限制（如维州、昆州等）

### 网站必须实现的合规要点

| 合规要求 | 实现方式 | 优先级 |
| :--- | :--- | :--- |
| **年龄验证（18+）** | 进入网站前强制年龄门控，记录验证日期和IP | 关键 |
| **健康警告** | 在产品页面、购物车、结账页面显示强制性健康警告 | 关键 |
| **TGA警告标签** | 展示官方TGA警告文本 | 关键 |
| **使用条款** | 清晰的法律免责声明和使用条款 | 关键 |
| **隐私政策** | 符合澳洲隐私法的数据处理政策 | 关键 |
| **购买限制** | 单笔订单限制数量，防止批量采购 | 重要 |
| **配送限制** | 仅限澳洲本土配送，验证收货地址 | 重要 |
| **支付验证** | 使用Stripe进行安全支付，记录交易 | 重要 |

---

## 功能架构

### 1. 年龄门控系统 (Age Gate)

**功能描述：** 用户首次访问网站时必须通过年龄验证，验证通过后在会话期间不再重复验证。

**实现细节：**
- 强制性年龄确认页面（在任何产品信息之前）
- 用户需输入出生日期或勾选"我已满18岁"确认框
- 验证失败显示拒绝访问页面
- 使用浏览器localStorage存储验证状态（客户端）+ 会话cookie（服务器端）
- 记录验证时间戳、IP地址、用户代理到数据库（审计追踪）

**设计风格：** 严肃、专业、清晰的法律警告文本

### 2. 产品展示与筛选系统

**功能描述：** 展示电子烟产品目录，支持多维度筛选和搜索。

**产品维度：**
- 品牌（RELX、Vuse、JUUL等）
- 口味分类（薄荷、水果、烟草等）
- 尼古丁含量（0mg、6mg、12mg、18mg等）
- 价格区间
- 库存状态

**UI特性：**
- 网格布局展示产品卡片（每张卡片包含：产品图、名称、口味、尼古丁含量、价格、库存状态）
- 左侧筛选栏或顶部筛选标签
- 产品详情页面（高清图片、完整参数、成分说明、用户评价）
- 响应式设计（桌面3列、平板2列、手机1列）

### 3. 购物车与结账流程

**功能描述：** 用户选择产品后加入购物车，完成结账流程。

**关键功能：**
- 购物车持久化（localStorage + 数据库）
- 实时库存检查
- 优惠券/折扣代码支持
- 配送地址验证（仅限澳洲）
- 订单总结页面（显示所有费用、税费、配送费）
- 健康警告确认复选框（用户必须勾选才能继续）

**Stripe集成：**
- 使用Stripe Payment Element进行安全支付
- 支持信用卡、借记卡、澳洲本地支付方式（如Afterpay、Zip）
- 支付成功后生成订单号和确认邮件

### 4. 用户账户系统

**功能描述：** 用户可创建账户、管理订单和配送地址。

**核心功能：**
- 用户注册/登录（使用Manus OAuth）
- 订单历史查询（显示订单号、日期、状态、金额）
- 配送地址管理（添加、编辑、删除）
- 订阅管理（如有定期配送服务）
- 账户设置（邮件通知偏好、隐私设置）

### 5. 法律合规展示模块

**功能描述：** 清晰展示所有必需的法律文本和警告。

**包含内容：**
- **健康警告：** 在页脚、产品页面、结账页面显示
- **使用条款：** 独立页面，详细说明购买限制、配送政策、退货政策
- **隐私政策：** 符合澳洲隐私法（Privacy Act 1988）
- **TGA声明：** 官方TGA警告文本
- **年龄验证记录：** 用户可查看自己的验证历史

### 6. 响应式设计

**设计原则：**
- 移动端优先（从小屏幕开始设计）
- 断点：320px（手机）、768px（平板）、1024px（桌面）
- 触摸友好的交互元素（按钮最小48px）
- 快速加载（图片优化、懒加载）

---

## 数据库架构

### 核心表结构

```sql
-- 用户表（继承自模板）
users (id, openId, name, email, role, createdAt, updatedAt, lastSignedIn)

-- 产品表
products (
  id, 
  name, 
  brand, 
  flavor, 
  nicotineContent, 
  price, 
  stock, 
  description, 
  imageUrl, 
  createdAt, 
  updatedAt
)

-- 订单表
orders (
  id, 
  userId, 
  orderNumber, 
  status, 
  totalAmount, 
  taxAmount, 
  shippingCost, 
  shippingAddress, 
  stripePaymentIntentId, 
  createdAt, 
  updatedAt
)

-- 订单项目表
orderItems (
  id, 
  orderId, 
  productId, 
  quantity, 
  unitPrice, 
  createdAt
)

-- 用户地址表
userAddresses (
  id, 
  userId, 
  street, 
  suburb, 
  state, 
  postcode, 
  country, 
  isDefault, 
  createdAt, 
  updatedAt
)

-- 年龄验证审计表
ageVerifications (
  id, 
  userId, 
  verificationMethod, 
  verifiedAt, 
  ipAddress, 
  userAgent, 
  createdAt
)
```

---

## 技术栈

| 层级 | 技术 | 版本 |
| :--- | :--- | :--- |
| **前端框架** | React | 19 |
| **样式** | Tailwind CSS | 4 |
| **UI组件** | shadcn/ui | 最新 |
| **后端框架** | Express | 4 |
| **API框架** | tRPC | 11 |
| **数据库** | MySQL | 8 |
| **ORM** | Drizzle | 0.44 |
| **支付** | Stripe | 最新 |
| **认证** | Manus OAuth | 集成 |
| **测试** | Vitest | 2.1 |

---

## 设计风格指南

### 色彩方案（极简科技风格）

- **主色：** 深空灰 (`#1a1a1a`)
- **辅助色：** 冰川白 (`#f8f9fa`)
- **强调色：** 极光蓝 (`#0066cc`)
- **警告色：** 警告红 (`#d32f2f`)
- **成功色：** 成功绿 (`#388e3c`)

### 字体

- **标题字体：** Inter Bold (无衬线，现代感)
- **正文字体：** Inter Regular (易读性)
- **等宽字体：** Courier New (代码/参数显示)

### 布局原则

- 大面积留白，突出产品
- 非对称布局（避免单调）
- 清晰的视觉层级
- 微交互（悬停效果、平滑过渡）

---

## 项目里程碑

| 阶段 | 任务 | 预计时间 |
| :--- | :--- | :--- |
| **第1阶段** | 数据库架构设计、Stripe配置 | 1天 |
| **第2阶段** | 年龄门控和法律合规模块 | 1天 |
| **第3阶段** | 产品展示和筛选系统 | 1.5天 |
| **第4阶段** | 购物车、结账、支付集成 | 2天 |
| **第5阶段** | 用户账户系统 | 1.5天 |
| **第6阶段** | 响应式优化、测试、部署 | 1天 |

---

## 关键风险与缓解措施

| 风险 | 影响 | 缓解措施 |
| :--- | :--- | :--- |
| **法规变化** | 网站可能违规 | 定期审查澳洲TGA和州法规更新 |
| **支付失败** | 用户无法完成购买 | 实现Stripe错误处理和重试机制 |
| **库存不同步** | 超卖 | 实时库存检查，订单确认前锁定库存 |
| **数据隐私泄露** | 法律风险 | 加密敏感数据，定期安全审计 |

---

## 下一步行动

1. ✅ 创建项目规划文档（本文档）
2. ⏳ 配置Stripe和数据库架构
3. ⏳ 实现年龄门控和法律合规模块
4. ⏳ 开发产品展示和筛选系统
5. ⏳ 实现购物车、结账和用户账户
6. ⏳ 响应式设计优化和测试
7. ⏳ 同步至GitHub并部署

---

**文档版本：** 1.0  
**最后更新：** 2026年1月1日  
**作者：** Manus AI
